# -*- coding: utf-8 -*-
# code warrior: Barid
import tensorflow as tf
from UNIVERSAL.evaluation.get_test_data import get_SemEval


class WEcos_MetricLayer(tf.keras.layers.Layer):
    def __init__(self, name="WEcos"):
        # self.mean_fn = tf.keras.metrics.Mean(name)
        self.hyps = [
            [53254],
            [12170],
            [58183],
            [58183],
            [16336],
            [16336],
            [16336],
            [55574],
            [55574],
            [40526],
            [10435],
            [10435],
            [33192],
            [19016],
            [19016],
            [49173],
            [49173],
            [49173],
            [49173],
            [5380],
            [10617],
            [18120],
            [18120],
            [18120],
            [18120],
            [37453],
            [25031],
            [25031],
            [25031],
            [25031],
            [4569],
            [17506],
            [15466],
            [15466],
            [13844],
            [21703],
            [21703],
            [26460],
            [19012],
            [19012],
            [4203],
            [33553],
            [14857],
            [37728],
            [30606],
            [49972],
            [49972],
            [19364],
            [10863],
            [22318],
            [57569],
            [33024],
            [58101],
            [46267],
            [24076],
            [24076],
            [24076],
            [43834],
            [15930],
            [15894],
            [15894],
            [15894],
            [20330],
            [11162],
            [18791],
            [18791],
            [18791],
            [18791],
            [23223],
            [23223],
            [23223],
            [23223],
            [23223],
            [38667],
            [38667],
            [38667],
            [6238],
            [30762],
            [22827],
            [22827],
            [20110],
            [54463],
            [46115],
            [9320],
            [9320],
            [6723],
            [21663],
            [3651],
            [3651],
            [3651],
            [32483],
            [32483],
            [32483],
            [32483],
            [32483],
            [30199],
            [10520],
            [3464],
            [43248],
            [41125],
            [41125],
            [41125],
            [25678],
            [26586],
            [26586],
            [26586],
            [32916],
            [32916],
            [32916],
            [20165],
            [23568],
            [17578],
            [17578],
            [17578],
            [20536],
            [26264],
            [33807],
            [53845],
            [35916],
            [35916],
            [18363],
            [18363],
            [54115],
            [20018],
            [15798],
            [15798],
            [32291],
            [32291],
            [26467],
            [26467],
            [25086],
            [20722],
            [14760],
            [14760],
            [14760],
            [26290],
            [45081],
            [45081],
            [45081],
            [36878],
            [55696],
            [17460],
            [44544],
            [29419],
            [29419],
            [14842],
            [14842],
            [12502],
            [5632],
            [5632],
            [23126],
            [23126],
            [39495],
            [39495],
            [3442],
            [12902],
            [12902],
            [12902],
            [12902],
            [54131],
            [54131],
            [31789],
            [16833],
            [29488],
            [29488],
            [29488],
            [15174],
            [34531],
            [22595],
            [14224],
            [33129],
            [22323],
            [22323],
            [22323],
            [5762],
            [39420],
            [39420],
            [40783],
            [40783],
            [29828],
            [23275],
            [27366],
            [27366],
            [36208],
            [23882],
            [23882],
            [25590],
            [25590],
            [14835],
            [14835],
            [46371],
            [50102],
            [14721],
            [14721],
            [28149],
            [19079],
            [19079],
            [19079],
            [21835],
            [21835],
            [10205],
            [10205],
            [12645],
            [12645],
            [55000],
            [55000],
            [24808],
            [24808],
            [24808],
            [21300],
            [21300],
            [34969],
            [34969],
            [34969],
            [37917],
            [32780],
            [51728],
            [51728],
            [51728],
            [15986],
            [15986],
            [20785],
            [20785],
            [20785],
            [4289],
            [5225],
            [5225],
            [41677],
            [40986],
            [10750],
            [37835],
            [7272],
            [37603],
            [37603],
            [37603],
            [37603],
            [27147],
            [27147],
            [23404],
            [23404],
            [23404],
            [3818],
            [51899],
            [51899],
            [51899],
            [51899],
            [13080],
            [13080],
            [5400],
            [19755],
            [14773],
            [3715],
            [38656],
            [35068],
            [35068],
            [4373],
            [12990],
            [32715],
            [32715],
            [32715],
            [32715],
            [32715],
            [23306],
            [23306],
            [23306],
            [23306],
            [23306],
            [16464],
            [26724],
            [28005],
            [32518],
            [32518],
            [32518],
            [30970],
            [14756],
            [29860],
            [29860],
            [47830],
            [17017],
            [17017],
            [17017],
            [39866],
            [29930],
            [23187],
            [26934],
            [26934],
            [48547],
            [22317],
            [17903],
            [12869],
            [12869],
            [27008],
            [27008],
            [11326],
            [11326],
            [11326],
            [11326],
            [16075],
            [38051],
            [41400],
            [41400],
            [3766],
            [34600],
            [20549],
            [20549],
            [26006],
            [18761],
            [32471],
            [38726],
            [21342],
            [5499],
            [34898],
            [20247],
            [30487],
            [19499],
            [20790],
            [10881],
            [52407],
            [52407],
            [58950],
            [30478],
            [4752],
            [27159],
            [9838],
            [36597],
            [36444],
            [16795],
            [6537],
            [20890],
            [41950],
            [26689],
            [26689],
            [29589],
            [10874],
            [17367],
            [11556],
            [11556],
            [36915],
            [24995],
            [24995],
            [12268],
            [12268],
            [30785],
            [30785],
            [23912],
            [23912],
            [10833],
            [10833],
            [41454],
            [41454],
            [41454],
            [41454],
            [27577],
            [26557],
            [26557],
            [9286],
            [9286],
            [19908],
            [47166],
            [50032],
            [50032],
            [28513],
            [28513],
            [28513],
            [28513],
            [14963],
            [17168],
            [17168],
            [17168],
            [17168],
            [30744],
            [11187],
            [31440],
            [39024],
            [39024],
            [39024],
            [39024],
            [37655],
            [5014],
            [22872],
            [46840],
            [46840],
            [46840],
            [58710],
            [58710],
            [58710],
            [58710],
            [17399],
            [30878],
            [17802],
            [22204],
            [22204],
            [22204],
            [41109],
            [46937],
            [17828],
            [26727],
            [8221],
            [48883],
            [34273],
            [5421],
            [40323],
            [18757],
            [18757],
            [18757],
            [34381],
            [34381],
            [17320],
            [7886],
            [17260],
            [22089],
            [19614],
            [21380],
            [21380],
            [19416],
            [19416],
            [29055],
            [59409],
            [13685],
            [29179],
            [16207],
            [31167],
            [31167],
            [3875],
            [30049],
            [30049],
            [18992],
            [16532],
            [48866],
            [13870],
            [15713],
            [15713],
            [15713],
            [15713],
            [26127],
            [22168],
            [27286],
            [22829],
            [22829],
            [22829],
            [28223],
            [28223],
            [28223],
            [15305],
            [41666],
            [41666],
            [18381],
            [3329],
            [31988],
            [24422],
            [37449],
            [30175],
            [30175],
            [41279],
            [33903],
            [33903],
            [33903],
            [47819],
            [41905],
            [3368],
            [24379],
            [14992],
            [40377],
            [44612],
            [44612],
            [16095],
            [25055],
            [16873],
            [16873],
            [14774],
            [14774],
            [14774],
            [14774],
            [44724],
            [44724],
            [19574],
            [19574],
            [38109],
            [38109],
            [58909],
            [58909],
            [23045],
            [23045],
            [23045],
            [44070],
            [44070],
            [20308],
            [20308],
            [20308],
            [20308],
            [20308],
            [21502],
            [21502],
            [21502],
            [21502],
            [55438],
            [55438],
            [32102],
            [16078],
            [31864],
            [29834],
            [29834],
            [29834],
            [21826],
            [21826],
            [31513],
            [15826],
            [15826],
            [34536],
            [44063],
            [23123],
            [4208],
            [4208],
            [36087],
            [36087],
            [36777],
            [36777],
            [36777],
            [27367],
            [49258],
            [49258],
            [49258],
            [49258],
            [49258],
            [13922],
            [13922],
            [41123],
            [41123],
            [29498],
            [35312],
            [35312],
            [51692],
            [43848],
            [29671],
            [7192],
            [29989],
            [29989],
            [29989],
            [29989],
            [25145],
            [30865],
            [17553],
            [17553],
            [17553],
            [17553],
            [41281],
            [23281],
            [23281],
            [23281],
            [23281],
            [23281],
            [19401],
            [13607],
            [45957],
            [43741],
            [43741],
            [3376],
            [24321],
            [40824],
            [40824],
            [11402],
            [21896],
            [21896],
            [21896],
            [12977],
            [17057],
            [17057],
            [27738],
            [59061],
            [59061],
            [41594],
            [48855],
            [48855],
            [39074],
            [39074],
            [39157],
            [34490],
            [31405],
            [31405],
            [32315],
            [32315],
            [8508],
            [25177],
            [25177],
            [25177],
            [25177],
            [30028],
            [47016],
            [25315],
            [17574],
            [21133],
            [21133],
            [38222],
            [38222],
            [18055],
            [34414],
            [34414],
            [49842],
            [49842],
            [24353],
            [24450],
            [22808],
            [3640],
            [19712],
            [19712],
            [19712],
            [29479],
            [29479],
            [29479],
            [25624],
            [52751],
            [6070],
            [17015],
            [17015],
            [49430],
            [47282],
            [47282],
            [29456],
            [56995],
            [6737],
            [6737],
            [6737],
            [6737],
            [41819],
            [23887],
            [22452],
            [22452],
            [22452],
            [11369],
            [54318],
            [54318],
            [48195],
            [22441],
            [22441],
            [25190],
            [38594],
            [28944],
            [28944],
            [28944],
            [4199],
            [45732],
            [45732],
            [22995],
            [22995],
            [23262],
            [55349],
            [55349],
            [26944],
            [35306],
            [35306],
            [35306],
            [4359],
            [20433],
            [20433],
            [12887],
            [10210],
            [10540],
            [51580],
            [51580],
            [44287],
            [51064],
            [51064],
            [51064],
            [51064],
            [53477],
            [53477],
            [53477],
            [31973],
            [31973],
            [31973],
            [21659],
            [29345],
            [34205],
            [34205],
            [34205],
            [34205],
            [13243],
            [13243],
            [13243],
            [13243],
            [13243],
            [23607],
            [33176],
            [33176],
            [42259],
            [42259],
            [42259],
            [27611],
            [3701],
            [22396],
            [35014],
            [34881],
            [34881],
            [31813],
            [31813],
            [36846],
            [36846],
            [36846],
            [27439],
            [37718],
            [52342],
            [13386],
            [25791],
            [25791],
            [25791],
            [28876],
            [28876],
            [36590],
            [36590],
            [38542],
            [38542],
            [4718],
            [7681],
            [7681],
            [32669],
            [32669],
            [28739],
            [25757],
        ]
        self.refs = [
            [25165],
            [6828],
            [5470],
            [12119],
            [42534],
            [36427],
            [9005],
            [55574],
            [47406],
            [6394],
            [10435],
            [45082],
            [19792],
            [19016],
            [27174],
            [22445],
            [29477],
            [9923],
            [38163],
            [5380],
            [10617],
            [28914],
            [30940],
            [4261],
            [44056],
            [37453],
            [48003],
            [19985],
            [19896],
            [23848],
            [4569],
            [17506],
            [13941],
            [24361],
            [13844],
            [4087],
            [21946],
            [26460],
            [5817],
            [43178],
            [4203],
            [21810],
            [14857],
            [42735],
            [7181],
            [7394],
            [12063],
            [19364],
            [10863],
            [17491],
            [24894],
            [33024],
            [17885],
            [31519],
            [54131],
            [24076],
            [33679],
            [45688],
            [6217],
            [58248],
            [19026],
            [12589],
            [31449],
            [11162],
            [32910],
            [7527],
            [38074],
            [26445],
            [26702],
            [53395],
            [47523],
            [39799],
            [25202],
            [19975],
            [32373],
            [21067],
            [6238],
            [21972],
            [20442],
            [4331],
            [20110],
            [54463],
            [29837],
            [34478],
            [7694],
            [6723],
            [21663],
            [9679],
            [2835],
            [3651],
            [13621],
            [5046],
            [30345],
            [16955],
            [21842],
            [30199],
            [10520],
            [3464],
            [9923],
            [38643],
            [48291],
            [36056],
            [16402],
            [54425],
            [12466],
            [26510],
            [31943],
            [34505],
            [22633],
            [10658],
            [49132],
            [9364],
            [52466],
            [17578],
            [8688],
            [26264],
            [8912],
            [3764],
            [27183],
            [10728],
            [50882],
            [18363],
            [24315],
            [5012],
            [20230],
            [5436],
            [38643],
            [36056],
            [5991],
            [12743],
            [17900],
            [20722],
            [30940],
            [4261],
            [40027],
            [16226],
            [16444],
            [11567],
            [15125],
            [14908],
            [55696],
            [17460],
            [44544],
            [43964],
            [17771],
            [14842],
            [33410],
            [12502],
            [16566],
            [5632],
            [28602],
            [20332],
            [29510],
            [7692],
            [3442],
            [9951],
            [22103],
            [29664],
            [9433],
            [54131],
            [24076],
            [17054],
            [16833],
            [9679],
            [2835],
            [5914],
            [15174],
            [36453],
            [36555],
            [5855],
            [13604],
            [7181],
            [9779],
            [5636],
            [5762],
            [7929],
            [18448],
            [8999],
            [40783],
            [41120],
            [23275],
            [3639],
            [6178],
            [15653],
            [10078],
            [24063],
            [8856],
            [16076],
            [5436],
            [29190],
            [46371],
            [25980],
            [18855],
            [19498],
            [5526],
            [8069],
            [36531],
            [19938],
            [29165],
            [15675],
            [8025],
            [10205],
            [29259],
            [12259],
            [13185],
            [15890],
            [55301],
            [33142],
            [11031],
            [29089],
            [13248],
            [47958],
            [28480],
            [46942],
            [44363],
            [38174],
            [24864],
            [32310],
            [40416],
            [6482],
            [52827],
            [5334],
            [40837],
            [20779],
            [4289],
            [5225],
            [3380],
            [41677],
            [3424],
            [10750],
            [5499],
            [7272],
            [51135],
            [29570],
            [27625],
            [15655],
            [39349],
            [55451],
            [9710],
            [6586],
            [14156],
            [3818],
            [14002],
            [24858],
            [28480],
            [46942],
            [38063],
            [13080],
            [5400],
            [4170],
            [8118],
            [3715],
            [17929],
            [55566],
            [6579],
            [4373],
            [12990],
            [40693],
            [27376],
            [3818],
            [38408],
            [20709],
            [49006],
            [26217],
            [23979],
            [59696],
            [25665],
            [17562],
            [26724],
            [28005],
            [8836],
            [31519],
            [27645],
            [12771],
            [5237],
            [22022],
            [7126],
            [30597],
            [50604],
            [32335],
            [4486],
            [46504],
            [9916],
            [33991],
            [14235],
            [32447],
            [22353],
            [22317],
            [11722],
            [52534],
            [12869],
            [19121],
            [23599],
            [58153],
            [29996],
            [6569],
            [11326],
            [16075],
            [5135],
            [58271],
            [15183],
            [3766],
            [35169],
            [43729],
            [30323],
            [5257],
            [18761],
            [51943],
            [7654],
            [13605],
            [14363],
            [5458],
            [7750],
            [4814],
            [19499],
            [20790],
            [10881],
            [12162],
            [28783],
            [42755],
            [23919],
            [4752],
            [13410],
            [9838],
            [36597],
            [36444],
            [19190],
            [6537],
            [20890],
            [21597],
            [26689],
            [40653],
            [23789],
            [10874],
            [17367],
            [11556],
            [13139],
            [17164],
            [19317],
            [2869],
            [49108],
            [42654],
            [11627],
            [46612],
            [23912],
            [27734],
            [5262],
            [17519],
            [39310],
            [29753],
            [59786],
            [18809],
            [41120],
            [17411],
            [11333],
            [4553],
            [9286],
            [19908],
            [47166],
            [44367],
            [9092],
            [11437],
            [7094],
            [9303],
            [17075],
            [14963],
            [19194],
            [9441],
            [23725],
            [9783],
            [35690],
            [4351],
            [20932],
            [28358],
            [11632],
            [10094],
            [14069],
            [4468],
            [5014],
            [22872],
            [48630],
            [17461],
            [13375],
            [17960],
            [42430],
            [44417],
            [40622],
            [17399],
            [30878],
            [17802],
            [34303],
            [53982],
            [10021],
            [32373],
            [20667],
            [17828],
            [26727],
            [8221],
            [14891],
            [16670],
            [5421],
            [40323],
            [28847],
            [4834],
            [21781],
            [54207],
            [10385],
            [7192],
            [7886],
            [5470],
            [22089],
            [3523],
            [50781],
            [34619],
            [7416],
            [28238],
            [10077],
            [14956],
            [13685],
            [26714],
            [16207],
            [5965],
            [17969],
            [3875],
            [30049],
            [33402],
            [29089],
            [16532],
            [20667],
            [13870],
            [8280],
            [49883],
            [15771],
            [18340],
            [40599],
            [22168],
            [9635],
            [12347],
            [41575],
            [38695],
            [19784],
            [20779],
            [34641],
            [15305],
            [11763],
            [42755],
            [5029],
            [3329],
            [7113],
            [24422],
            [37449],
            [19750],
            [30437],
            [37022],
            [50892],
            [41347],
            [44408],
            [47819],
            [8646],
            [3368],
            [20637],
            [14992],
            [40377],
            [14439],
            [32976],
            [16095],
            [10272],
            [27285],
            [16873],
            [57024],
            [38494],
            [21084],
            [26729],
            [5225],
            [22143],
            [23161],
            [16499],
            [24879],
            [22133],
            [44973],
            [15789],
            [16057],
            [8297],
            [16825],
            [12283],
            [11452],
            [42884],
            [14636],
            [29881],
            [44645],
            [18755],
            [26552],
            [12333],
            [57766],
            [4184],
            [21279],
            [45900],
            [3859],
            [16078],
            [57432],
            [15770],
            [20393],
            [31536],
            [6104],
            [21826],
            [31513],
            [23177],
            [6916],
            [13961],
            [23878],
            [6716],
            [3165],
            [4208],
            [49785],
            [59016],
            [12804],
            [36646],
            [58783],
            [7341],
            [31953],
            [4590],
            [19736],
            [8638],
            [21657],
            [8348],
            [10381],
            [46705],
            [17589],
            [8118],
            [7685],
            [10579],
            [16083],
            [5838],
            [9642],
            [7192],
            [4936],
            [10707],
            [14361],
            [28560],
            [8375],
            [28056],
            [10756],
            [7666],
            [59819],
            [25932],
            [31821],
            [43944],
            [22366],
            [16579],
            [18018],
            [18555],
            [38040],
            [13607],
            [11544],
            [19657],
            [49951],
            [3376],
            [45683],
            [14636],
            [30914],
            [11402],
            [49389],
            [12651],
            [56867],
            [12977],
            [7731],
            [9269],
            [27738],
            [52348],
            [53140],
            [7722],
            [37492],
            [9910],
            [40614],
            [18816],
            [59696],
            [34490],
            [11410],
            [11537],
            [32315],
            [10409],
            [8508],
            [14366],
            [17188],
            [16579],
            [13736],
            [30028],
            [5819],
            [25315],
            [18402],
            [23196],
            [5811],
            [23400],
            [15059],
            [18055],
            [22599],
            [20272],
            [26089],
            [26903],
            [40465],
            [24450],
            [6587],
            [3640],
            [59385],
            [20230],
            [3568],
            [20493],
            [4417],
            [27915],
            [30328],
            [52751],
            [6070],
            [7456],
            [38110],
            [49430],
            [38080],
            [17461],
            [18271],
            [56995],
            [5298],
            [16628],
            [10668],
            [38756],
            [47324],
            [46665],
            [34978],
            [29109],
            [10519],
            [11369],
            [54318],
            [52104],
            [48195],
            [59793],
            [37347],
            [18490],
            [13722],
            [9486],
            [18377],
            [18942],
            [4199],
            [15418],
            [12223],
            [27296],
            [7126],
            [9106],
            [31396],
            [7516],
            [52954],
            [8261],
            [50319],
            [7020],
            [4359],
            [22491],
            [58876],
            [12887],
            [10210],
            [10540],
            [22594],
            [8682],
            [6302],
            [10826],
            [5310],
            [19173],
            [3446],
            [12231],
            [41865],
            [23418],
            [10451],
            [21445],
            [31944],
            [6987],
            [7044],
            [57500],
            [16520],
            [30733],
            [49316],
            [10486],
            [31143],
            [3566],
            [5716],
            [28818],
            [23607],
            [9619],
            [11452],
            [30246],
            [34060],
            [49167],
            [39950],
            [3701],
            [40927],
            [10547],
            [36186],
            [56300],
            [31813],
            [55425],
            [40260],
            [28494],
            [59696],
            [19477],
            [5838],
            [48507],
            [13386],
            [52047],
            [9816],
            [25791],
            [28876],
            [54405],
            [16529],
            [21709],
            [29897],
            [21921],
            [4718],
            [7681],
            [9346],
            [22916],
            [20355],
            [28739],
            [25757],
        ]
        self.metric_name = name
        super(WEcos_MetricLayer, self).__init__(name=name)

    def build(self, input_shape):
        """"Builds metric layer."""
        super(WEcos_MetricLayer, self).build(input_shape)

    def call(
        self, embeddings,
    ):
        # self.add_loss(inputs * penalty)
        vec_src = embeddings(self.hyps)
        vec_tgt = embeddings(self.refs)
        cosine = tf.reduce_mean(-tf.keras.losses.cosine_similarity(vec_src, vec_tgt), 0)
        self.add_metric(cosine, name=self.metric_name, aggregation="mean")
        return cosine
